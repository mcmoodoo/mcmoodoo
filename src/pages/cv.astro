---
import Layout from '@/layouts/Layout.astro'
import { experiences, education, skills, publications, hackathons } from '../data/cv'
import CvTimeline from '@/components/ui/CvTimeline.astro'

import type { Experience, Education, Publication, Hackathon } from '../types/cv'
import List from '@/components/ui/List.astro'
import PublicationsList from '@/components/ui/PublicationsList.astro'

let orderedExperiences: Experience[] = []
let orderedEducations: Education[] = []
let orderedPublications: Publication[] = []

const orderElement = <T extends { time: string }>(a: T, b: T) => {
  const presentValues = ['present', 'now', 'current', 'today']
  if (
			presentValues.includes(
				(a['time'] as string)?.split(' - ')[1]?.toLowerCase()
			)
		) {
			// If the date is 'present', it should be the first element
			return -1
		}
		const dateA = new Date((a['time'] as string)?.split(' - ')[1])
		const dateB = new Date((b['time'] as string)?.split(' - ')[1])
		return dateB.getTime() - dateA.getTime()
}

if (experiences.length > 0) {
	orderedExperiences = experiences.sort((a, b) => {
		return orderElement(a, b)
	})
}

if (education.length > 0) {
	orderedEducations = education.sort((a, b) => {
		return orderElement(a, b)
	})
}

if (publications.length > 0) {
	orderedPublications = publications.sort((a, b) => {
		return orderElement(a, b)
	})
}
---

<Layout title="CV" description="Career experience, education, and skills of Rashid McMoodoo">
	<div class='mb-8 pb-6 border-b'>
		<a
			href='https://mcmoodoo.s3.us-east-1.amazonaws.com/Resume_Rashid_Mak.pdf'
			target='_blank'
			rel='noopener noreferrer'
			class='btn btn-primary'
		>
			<svg xmlns='http://www.w3.org/2000/svg' class='h-5 w-5 mr-2' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
				<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4' />
			</svg>
			 Resume
		</a>
	</div>
	{
		orderedExperiences.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Experiences
				</h2>
				<CvTimeline elements={orderedExperiences} colored={true} />
			</section>
		)
	}

	{
		orderedEducations.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Education
				</h2>
				<CvTimeline elements={orderedEducations} colored={true} />
			</section>
		)
	}

	{
		hackathons.length > 0 && (
			<section class='mb-12'>
				<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
					Hackathons
					<a href='/hackathons' class='text-sm font-normal ml-2 text-primary hover:underline'>
						Read the full story →
					</a>
				</h2>
				<div class='space-y-4'>
					{hackathons.map((h: Hackathon) => (
						<div class='p-4 rounded-lg border bg-base-200/50'>
							<div class='flex flex-wrap items-center gap-2 mb-2'>
								<span class='font-semibold'>{h.event}</span>
								<span class='badge badge-primary'>{h.result}</span>
							</div>
							<div class='text-sm opacity-70 mb-2'>
								{h.time} • {h.location}
							</div>
							{h.project && (
								<div class='font-medium text-sm mb-1'>
									Project: {h.project}
								</div>
							)}
							{h.description && (
								<p class='text-sm opacity-80'>{h.description}</p>
							)}
							{h.link && (
								<a href={h.link} target='_blank' rel='noopener noreferrer' class='text-sm text-primary hover:underline mt-2 inline-block'>
									View project →
								</a>
							)}
						</div>
					))}
				</div>
			</section>
		)
	}
</Layout>
